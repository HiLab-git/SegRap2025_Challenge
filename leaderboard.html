<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SegRap2025 Challenge</title>
  <link rel="stylesheet" href="shared.css">
  <style>
    table {
      color: var(--text-secondary);
      font-size: 0.85em;
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      border: 1px solid #ccc;
    }

    th,
    td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ccc;
    }

    .people-section {
      margin-bottom: 60px;
    }

    .metric-name {
      font-weight: 500;
      color: var(--text-primary);
      font-size: 20px;
      margin-bottom: 8px;
      margin-top: 20px;
    }

    .metric-description {
      color: var(--text-secondary);
      font-size: 0.95em;
      line-height: 1.5;
      width: 100%;
    }

    .sheet-description {
      color: var(--text-secondary);
      font-size: 0.85em;
      line-height: 1.5;
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="site-header">
    <div class="header-image" style="text-align: center;">
      <img src="logo_web.png" alt="SegRap Logo" style="width: 50%; height: auto;">
    </div>
    <div class="header-container">
      <div class="content-section">
        <nav class="nav-links">
          <a href="index.html">Home</a>
          <a href="tasks.html">Tasks</a>
          <a href="dataset.html">Dataset</a>
          <a href="evaluate.html">Evaluate</a>
          <a href="prizes.html">Prizes</a>
          <a href="leaderboard.html" class="active">Leaderboard</a>
          <a href="organizing.html">Organizing</a>
          <a href="contact.html">Contact</a>
        </nav>
      </div>
    </div>
  </div>

  <main class="main-content">
    <section>
      <h1 class="section-title">Leaderboard</h1>
      <div class="metric-description"> Last update: Aug 6, 2025 </div>
      <div class="metric-name"> Task01: GTV segmentation</div>
      <table id="task01-table">
        <thead>
          <tr>
            <th>Team</th>
            <th>DSC</th>
            <th>DSC Rank</th>
            <th>NSD</th>
            <th>NSD Rank</th>
            <th>Overall Rank</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="metric-name">Task02: LN CTV segmentation</div>
      <table id="task02-table">
        <thead>
          <tr>
            <th>Team</th>
            <th>DSC</th>
            <th>DSC Rank</th>
            <th>NSD</th>
            <th>NSD Rank</th>
            <th>Overall Rank</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script>
    async function loadLeaderboard() {
      const res = await fetch('leaderboard.json');
      const data = await res.json();

      for (const taskId of ['task01', 'task02']) {
        const entries = data[taskId];

        // 给定排序 key，分配允许并列的排名（并列后跳空）
        function assignRankWithTies(sortedArray, key) {
          let rank = 1;
          let prevScore = null;
          let sameCount = 0;

          sortedArray.forEach((entry, index) => {
            const score = entry[key];
            if (score === prevScore) {
              entry[`${key}Rank`] = rank;
              sameCount++;
            } else {
              rank = rank + sameCount;
              entry[`${key}Rank`] = rank;
              sameCount = 1;
              prevScore = score;
            }
          });
        }

        const sortedDSC = [...entries].sort((a, b) => b.dsc - a.dsc);
        assignRankWithTies(sortedDSC, 'dsc');

        const sortedNSD = [...entries].sort((a, b) => b.nsd - a.nsd);
        assignRankWithTies(sortedNSD, 'nsd');

        // 计算 overall = (dscRank + nsdRank) / 2
        entries.forEach(entry => {
          entry.overall = (entry.dscRank + entry.nsdRank) / 2;
        });

        const sortedOverall = [...entries].sort((a, b) => a.overall - b.overall);
        assignRankWithTies(sortedOverall, 'overall');

        // 将 finalRank 设置为 overallRank
        sortedOverall.forEach(entry => {
          entry.finalRank = entry.overallRank;
        });

        // 渲染表格
        const tableBody = document.querySelector(`#${taskId}-table tbody`);
        tableBody.innerHTML = sortedOverall.map(e => `
      <tr>
        <td>${e.team}</td>
        <td>${e.dsc.toFixed(4)}</td>
        <td>${e.dscRank}</td>
        <td>${e.nsd.toFixed(4)}</td>
        <td>${e.nsdRank}</td>
        <td>${e.finalRank}</td>
        <td>${e.time}</td>
      </tr>
    `).join('');
      }
    }


    loadLeaderboard();
  </script>
</body>

</html>